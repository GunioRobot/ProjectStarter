<Project DefaultTargets="All" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" 
    ToolsVersion="3.5">
    <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />

    <PropertyGroup Condition="'$(Configuration)'==''">
        <Configuration>Debug</Configuration>
    </PropertyGroup>

    <PropertyGroup Condition="'$(Configuration)'=='Debug'">
        <Optimize>false</Optimize>
        <DebugSymbols>true</DebugSymbols>
        <OutputPath>bin</OutputPath>
        <OutDir>bin\</OutDir>
        <IntermediateOutputPath>bin\</IntermediateOutputPath>
    </PropertyGroup>

  <UsingTask
    AssemblyFile="lib\xUnit-1.7\xunit.runner.msbuild.dll"
    TaskName="Xunit.Runner.MSBuild.xunit"/>



    <!-- Set the application name as a property -->
    <PropertyGroup>
        <appname>ProjectStarter</appname>
    </PropertyGroup>
    <ItemGroup>
        <AppFiles Include="src\\**\*.cs" />
        <AppReference Include="mscorlib.dll" />
        <AppReference Include="System.dll" />
        <AppReference Include="System.Core.dll" />
        <!-- Add your other references here -->

        <TestFiles Include="tests\\**\*.cs" />
        <TestReference Include="mscorlib.dll" />
        <TestReference Include="System.dll" />
        <TestReference Include="System.Core.dll" />
        <TestReference Include="lib/Xunit-1.7/xunit.dll" />
        <TestReference Include="lib/Moq.3.1.416.3-bin/Moq.dll" />
        <TestReference Include="bin/ProjectStarter.exe" />
    </ItemGroup>

    <Target Name="All" DependsOnTargets="Clean; Compile; CompileTests; RunTests">
        <Message Text="Compile All" />
    </Target>

    <Target Name = "Compile" DependsOnTargets="ResolveAssemblyReferences">    
        <Message Text="References = @(AppReference)" />
        <CSC Sources="@(AppFiles)"
            References="@(AppReference)"
            OutputAssembly="$(OutputPath)\$(AppName).exe"
            EmitDebugInformation="$(DebugSymbols)"
            TargetType="exe" /> 
    </Target>

    <Target Name="CompileTests">
        <Message Text="References = @(TestReference)" />
        <CSC Sources="@(TestFiles)"
            References="@(TestReference)"
            OutputAssembly="$(OutputPath)\$(AppName)-tests.dll"
            EmitDebugInformation="$(DebugSymbols)"
            TargetType="library" />
    </Target>

    <Target Name="RunTests" DependsOnTargets="Compile">
        <!-- Change this to point to your Assembly or exe -->
        <xunit Assembly="bin\ProjectStarter-tests.dll" />
    </Target>
    
    <Target Name="Clean">
        <Message Text="Cleaning previous build" />
    </Target>
</Project>


